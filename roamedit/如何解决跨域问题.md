如何解决跨域问题
---------------------------

如何解决跨域问题
   :PROPERTIES:
   :CUSTOM_ID: 如何解决跨域问题
   :END:

- [[跨域问题]]
- [[JSONP]] #解决方案

  - 原理

    - =script=标签可以进行跨域请求js文件，通过执行url中的回调函数实现跨域

  - 实现

    - jian'dan'shi'xian

      - 在html页面中定义一个函数，例如=showJson=
      - 在目标js文件中写入=showJson({a:1})=
      - 使用js动态插入=script=标签，在url后面加入callba

        - 使用js动态插入=script=标签，在url后面加入callback参数

      - 使用js动态插入=script=标签，在url后面加入callback参数

        - 使用js动态插入=script=标签，在url后面加入callback参数，前提

      - 优点

        - 简单易用
        - 无依赖类库

      - 缺点

        - 只能使用GETqin

    - [[JQuery]]实现

      - =$.ajax=方式

        - dataType设置成jsonp
        - jsonp为url中的参数名，默认为callback，可以手动指定
        - jsonpCallback为请求返回后的回调函数名称，如果不指定默认使用success回调使

          - 在url中增加=jsoncallback=?=，直接在回调函数中接收json返回值

      - =$.getJSON=方法
      - 优点

        - 可以有GET和POST的选择

      - 缺点

        - 返回的文件格式依旧为JSONP

  - 优点

    - 兼容性好

  - 缺点

    - 只能支持=GET=请求

- [[CORS]]#解决方案

  - #解决方案

    - 原理

      - 所有的浏览器都支持=Headers=中的=Cross-origin=系列

    - 实现

      - 在服务器端返回中增加=Access-Control-Allow-Origin=头信息，值设置为需要允许的域名，可以使用通配符

    - 优点

      - 前端不需要额外配置和关心
      - 服务端统一拦截处理
      - 可以自定义跨域规则
      - 支持各种qing'qiu

    - 缺点

      - 使用复杂请求是会增加一次=OPTIONS=请求

- [[Nginx]]反向代理 #解决方案

  - 原理

    - 利用[[Nginx]]的反向代理功能，统一域名

  - 实现

    - 把多个域名映射为同一域名下的多个路径空间

  - 优点

    - 集中式管理跨域
    - 增加服务时，可以只用配置一次

  - 缺点

    - 需要在[[Nginx]]进行额外的配置，多引入一个模块
    - 语义不清晰
    - 对于精细化的[[跨域]]控制无能为力

- [[IFrame]]+=[[document.domain]]= (仅适用同主域名) #解决方案

  - 原理

    - [[document.domain]]可以把值设置为当前域的父域

  - 实现

    - 在a.html页面中使用js动态创建并加载页面b.html
    - 在b.html修改[[document.domain]]为和a.html页面相同的父域名
    - 把a.html也设置一下[[document.domain]]

  - 优点

    - 不借助第三方类库

  - 缺点

    - 只适用于同一个主域名的跨域情况
    - 前端和后端都需要特殊处理

- [[IFrame]]+[[postMessage]]
